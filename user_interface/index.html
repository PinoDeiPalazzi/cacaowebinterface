<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<title>cacaoweb</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
	<link rel="stylesheet" href="css/general.css" type="text/css" media="screen">
</head>
<body>

	<noscript><div class="warning">This page will NOT work because Javascript is not enabled</div></noscript>
	
	<div id="fb-root"></div>
	<script>
	
		/** language management 
		*/
		var lang;
		var nav_lang;
		
		if (navigator.userLanguage) { // Explorer
			nav_lang = navigator.userLanguage;
		} else if (navigator.language) { // FF
			nav_lang = navigator.language;
		} else {
			nav_lang = 'en';
		}

		lang = nav_lang.substring(0, 2);
		var searchlang = lang;
		switch (lang) {
			case 'en':
				break;
			case 'fr':
				break;
			case 'it':
				break;
			case 'pl':
				break;
			default:
				lang = 'en';
		}
		
	</script>
	
	
	<div class="page_wrapper">
		<div id="head">
			<div id="toplogo" class="smalllogo hidden">
				<a href="http://www.cacaoweb.org/?noredirect=yes"><img src="img/logo.png" alt="cacaoweb"></a>
			</div>
			<div id="topsearchbox" class="topsearch hidden">
				<div class="input_wrapp">
					<input id="smallsearchbar" class="search_bar" name="search_bar" onkeypress="searchboxkeypress(event, this);" type="text" />
					<a class="search_submit" href="#" onclick="searchbuttonclick(event, this);">
						<img src="img/mag-glass.png" alt="Search">
					</a>
				</div>
			</div>
			<ul id="top-toolbar">
				<li id="auth-notification"></li>
				<li id="loginbutton"><a onclick="keepDropdownMenu(event, this)" class="outset"><span id="logintext"></span><span class="i"></span></a>
					<ul>
						<div class="loginarea">
						<form onsubmit="submitlogin(event)">
							<label for="login" id="loginlabel"></label>
							<input class="loginfield" id="logininput" name="login" type="text" />
							<label for="password" id="passwordlabel"></label>
							<input class="loginfield" id="passwordinput" name="password" type="password" />
							<div class="loginbuttons">
								<input type="submit" name="submit" id="loginbtn" />
								<a id="registerbtn" href="javascript:register()"></a>
							</div>
						</form>
						</div>
					</ul>
				</li>
				<li><a href="admin.html" class="inset icon i-heart hidden"><span id="share"></span><span class="i"></span></a></li>
				<li><a id="mana" href="admin.html" class="inset icon i-config"><span class="i"></span></a></li>
				<li><a onclick="keepDropdownMenu(event, this)" class="outset icon i-dropdown"><span id="more"></span><span class="i"></span></a>
					<ul>
						<li><a href="http://forum.cacaoweb.org/" target="_newtab" id="helpmenu"></a></li>
						<li><a href="http://forum.cacaoweb.org/" target="_newtab" id="forummenu"></a></li>
						<li><a href="http://cacaoweb.org/?noredirect#download" target="_newtab" id="downloadmenu"></a></li>
						<li><a href="http://cacaoweb.org/?noredirect#dev" target="_newtab" id="devmenu"></a></li>
						<li><a href="http://cacaoweb.org/?noredirect#money" target="_newtab" id="moneymenu"></a></li>
					</ul>
				</li>
				
			</ul>
		</div>
		<div id="content">
			<div id="warningarea" class="warning hidden"></div>
			<div id="mainsearch" class="center">
				<div class="logo">
					<a href="#"><img src="img/logo.png" alt="cacaoweb"></a>
				</div>
				<div class="mainpagesearchbar">
					<div class="input_wrapp">
						<input id="bigsearchbar" class="search_bar" onkeypress="searchboxkeypress(event, this);" autocomplete="off" type="text" />
						<a class="search_submit" href="#" onclick="searchbuttonclick(event, this);">
							<img src="img/mag-glass.png" alt="Search">
						</a>
					</div>
					<div id="searchhints"></div>
				</div>
			</div>
			<div id="searchresultsarea">
				<div id="didyoumean">
				</div>
				<div id="searchresults">
					<!-- <div class="searchentry">
						<div class="searchheader" id="merde" ><a href="#" onclick="play('http://127.0.0.1:4001/megavideo/megavideo.caml?videoid=fasdfs')">Cold Case Affaires classées S02E04.mp4</a></div>
						<div class="searchsummary" id="merde" >Cold Case Affaires classéesEpisode 2 saison 2 langue fr sous titres</div>
						<div class="searchlink"  id="merde" style="display:none">http://127.0.0.1:4001/?f=AB68768461</div>
						<div class="searchshowlink" ><a href="#" onclick="showlink(event)">show video link</a></div>
					</div> -->
				</div>
				<div id="searchresultsprevious" style="display:none"><a href="#"></a></div>
				<div id="searchresultsnext" style="display:none"><a href="#"></a></div>
			</div>
			<div id="playerarea" class="hidden">
				<div id="player">
				</div>
				<div id="sidebar">
					<div id="sidebar_inner"></div>
				</div>
			</div>
		</div>
		<div class="footer_push"></div><!-- needed for sticky footer -->
		
	</div> <!-- end wrapper -->
	<div id="footer" class="footer"></div>
	
	
	<script src="languagestrings.js" type="text/javascript"></script>
	<script type="text/javascript">	
	
		document.getElementById('mana').innerHTML = langstrings[lang]['management'] + '<span class="i"></span>';
		document.getElementById('searchhints').innerHTML = langstrings[lang]['searchhints'];
		//document.getElementsByTagName('title')[0].innerHTML = langstrings[lang]['cacaowebtitle'];
		document.getElementById('smallsearchbar').setAttribute('placeholder', langstrings[lang]['searchplaceholder']);
		document.getElementById('bigsearchbar').setAttribute('placeholder', langstrings[lang]['searchplaceholder']);
		document.getElementById('logintext').innerHTML = langstrings[lang]['login'];
		document.getElementById('loginlabel').innerHTML = langstrings[lang]['name'] + ':';
		document.getElementById('passwordlabel').innerHTML = langstrings[lang]['password'] + ':';
		document.getElementById('loginbtn').value = langstrings[lang]['login'].toLowerCase();
		document.getElementById('registerbtn').innerHTML = langstrings[lang]['register'];
		document.getElementById('share').innerHTML = langstrings[lang]['share'];
		document.getElementById('more').innerHTML = langstrings[lang]['more'];
		document.getElementById('helpmenu').innerHTML = langstrings[lang]['help'];
		document.getElementById('forummenu').innerHTML = langstrings[lang]['forum'];
		document.getElementById('downloadmenu').innerHTML = langstrings[lang]['download'];
		document.getElementById('devmenu').innerHTML = langstrings[lang]['developers'];
		document.getElementById('moneymenu').innerHTML = langstrings[lang]['makemoney'];
		
		
		var currentsearchpos = 0;
		var currentsearchterm = '';
		var username = '';
		var updateWarningsInterval = 20.0;
			
		function includeScript(filename, scriptname) {
			var htmlDoc = document.getElementsByTagName('body').item(0);
			var scriptblock = document.getElementById(scriptname); 
			if (scriptblock) {
				htmlDoc.removeChild(scriptblock);
			}
			var script = document.createElement("script");
		
			script.id = scriptname;
			script.src = filename;
			script.type = 'text/javascript';
			htmlDoc.appendChild(script);
		}
		function callbackWarnings(result) {
			var warnings = document.getElementById('warningarea');
			if (result == 'outdated') {
				warnings.innerHTML = langstrings[lang]['outdated'];
				warnings.style.display = "";
			} else if (result == 'noudp') {
				warnings.innerHTML = langstrings[lang]['noconnectivity'];
				warnings.style.display = "";
			} else if (result == 'permissionproblem') {
				warnings.innerHTML = langstrings[lang]['permissionproblem'];
				warnings.style.display = "";
			} else if (result == 'nospaceleft') {
				warnings.innerHTML = langstrings[lang]['nospaceleft'];
				warnings.style.display = "";
			} else if (result == 'badrouter') {
				warnings.innerHTML = langstrings[lang]['natnotp2pfriendly'];
				warnings.style.display = "";
			} else {
				warnings.style.display = "none";
			}
		}
		function updateWarnings() {
			var i = Math.floor(Math.random() * 1000000);
			includeScript('http://127.0.0.1:4001/errors?unique=' + i, 'warningsscript');
		}
		
		setInterval("updateWarnings()", updateWarningsInterval * 1000);		
		updateWarnings();
		
		function clearsearch() {
		}
		/** sets the page in play mode */
		function playmode() {
			document.getElementById('toplogo').style.display = "block";
			document.getElementById('topsearchbox').style.display = "block";
			document.getElementById('mainsearch').style.display = "none";
			
			document.getElementById('searchresults').innerHTML = "";
			document.getElementById('searchresultsprevious').style.display = "none";
			document.getElementById('searchresultsnext').style.display = "none";
		}
		/** sets the page in search results mode */
		function searchmode() {
			document.getElementById('toplogo').style.display = "block";
			document.getElementById('topsearchbox').style.display = "block";
			document.getElementById('mainsearch').style.display = "none";
			document.getElementById('footer').style.display = "none";
			
			document.getElementById('searchresults').innerHTML = "";
			document.getElementById('searchresultsprevious').style.display = "block";
			document.getElementById('searchresultsnext').style.display = "block";
		
		}
			
		
		function play(link) {
			playmode();
			
			var playerobj = '<object width="640" height="360"><param name="allowFullScreen" value="true" /><param name="flashvars" value="file=' + link + '" /><param name="movie" value="player.swf" /><embed src="player.swf" flashvars="file=' + link + '" width="640" height="360" allowFullScreen="true" /></object>';

			document.getElementById('player').innerHTML = playerobj;
			document.getElementById('playerarea').style.display = 'block';
		}
		
		/* parsesearchresults is called as a callback */
		function submitSearch(pos) {
			currentsearchpos = pos;
			includeScript('http://search.cacaoweb.org/?searchterm=' + encodeURIComponent(currentsearchterm) + '&lang=' + searchlang + '&pos=' + pos, 'searchscript');
		}
		
		function ismd5(s) {
			var ls = s.toUpperCase();
			if (ls.length == 32) {
				var c;
				for (var i = 0; i < 32; i++) {
					c = ls.charCodeAt(i);
					if (!((c >= 48 && c <= 57) || (c >= 65 && c <= 70))) {
						return false;
					}
				}
				return true;
			} else {
				return false;
			}
		}
			
		function processUserEntry() {
			document.getElementById('playerarea').style.display = 'none';
			document.getElementById('didyoumean').innerHTML = "";
			var searchitem = currentsearchterm;
			var iscacaoid = ismd5(searchitem);
			if (searchitem.indexOf('http://') == -1 && !iscacaoid) { // search
				if (searchitem != "") {
					submitSearch(0);
				}
			} else if (searchitem.indexOf('127.0.0.1') > -1 || iscacaoid) { // cacao
				var cacaolink = searchitem;
				var pos1 = searchitem.indexOf('f=');
				if (pos1 > -1) {
					cacaolink = searchitem.substr(pos1 + 2);
				} else {
					var pos2 = searchitem.lastIndexOf('/');
					if (pos2 > -1) {
						cacaolink = searchitem.substr(pos2 + 1);
					}
				}
				play("http://127.0.0.1:4001/" + cacaolink);
			} else if (searchitem.indexOf('v=') > -1) { // megavideo
				var pos1 = searchitem.indexOf('v=');
				var megavideoid = searchitem.substr(pos1 + 2);
				play("http://127.0.0.1:4001/megavideo/megavideo.caml?videoid=" + megavideoid);
			} else if (searchitem.indexOf('videobb.com/video/') > -1) { // videobb
				var pos1 = searchitem.lastIndexOf('/');
				var videobbid = searchitem.substr(pos1 + 1);
				play("http://127.0.0.1:4001/videobb/videobb.caml?videoid=" + videobbid);
			} else if (searchitem.indexOf('d=') > -1) { // megaupload
				alert("cacaoweb doesn't handle megaupload links");
			} else { // type inconnu
				alert(langstrings[lang]['linknotrecognized']);
				clearsearch();
				document.getElementById('searchhints').innerHTML = langstrings[lang]['typeoflinks'];
			}
		}
		
		function searchboxkeypress(oEvent, oInput) {
			var code;
			if (oInput.value == '') {
				return false;
			}
 
			if (oEvent && oEvent.which) {
				code = oEvent.which;
			} else {
				code = oEvent.keyCode;
			}
 
			if (code == 13) {
				currentsearchterm = oInput.value;
				processUserEntry();
				true;
			}
			return false;
		}
		function searchbuttonclick(e, o) {
			currentsearchterm = o.previousSibling.previousSibling.value;
			processUserEntry();
		}
		
		function parsesearchresults(results) {
			document.getElementById('searchhints').innerHTML = langstrings[lang]['searchhints'];;
			searchmode();
			var searchresults = document.getElementById('searchresults');
			
			if (results == "" || (results.showsresults.length == 0 && results.moviesresults.length == 0)) {
				searchresults.innerHTML = langstrings[lang]['noresults'];
				document.getElementById('searchresultsnext').style.display = 'none';
			}
			
			if (results.showsresults.length == 10) {
				document.getElementById('searchresultsnext').style.display = '';
				var newpos = parseInt(currentsearchpos) + 10;
				document.getElementById('searchresultsnext').innerHTML = '<a href="#" onclick="submitSearch(\'' + newpos + '\')">' + langstrings[lang]['next'] + '</a>';
			} else {
				document.getElementById('searchresultsnext').style.display = 'none';
			}
			if (currentsearchpos >= 10) { 
				document.getElementById('searchresultsprevious').style.display = '';
				var newpos = parseInt(currentsearchpos) - 10;
				document.getElementById('searchresultsprevious').innerHTML = '<a href="#" onclick="submitSearch(\'' + newpos + '\')">' + langstrings[lang]['previous'] + '</a>';
			} else {
				document.getElementById('searchresultsprevious').style.display = 'none';
			}
			for (var i = 0; i < results.showsresults.length; i++) { 
				var show = results.showsresults[i];
				var entry;
				entry = document.createElement('div');
				entry.setAttribute('class', "searchentry");
				var summary = show.showname + ' ' + langstrings[lang]['season'] + ' ' + show.season + ' ' + langstrings[lang]['episode'] + ' ' + show.episode;
				if (show.lang) {
					summary = summary + ' ' + langstrings[lang][show.lang];
				}
				if (show.subs) {
					summary = summary + ' ' + langstrings[lang]['subtitles'] + ': ' + langstrings[lang][show.subs];
				}
				entry.innerHTML = '<div class="searchheader"><a href="javascript:play(\'' + show.link + '\')">' + show.showname + ' S' + show.season + 'E' + show.episode + '</a></div><div class="searchsummary">' + summary + '</div><div class="searchlink" style="display:none">' + show.link + '</div><div class="searchshowlink"><a href="#" onclick="showlink(event, this)">' + langstrings[lang]['showlink'] + '</a></div>';
				searchresults.appendChild(entry);
			} 
			for (var i = 0; i < results.moviesresults.length; i++) { 
				var movie = results.moviesresults[i];
				var entry;
				entry = document.createElement('div');
				entry.setAttribute('class', "searchentry");
				var summary = movie.moviename;
				if (movie.lang) {
					summary = summary + ' ' + langstrings[lang][movie.lang];
				}
				if (movie.subs) {
					summary = summary + ' ' + langstrings[lang]['subtitles'] + ': ' + langstrings[lang][movie.subs];
				}
				entry.innerHTML = '<div class="searchheader"><a href="javascript:play(\'' + movie.link + '\')">' + movie.moviename + '</a></div><div class="searchsummary">' + summary + '</div><div class="searchlink" style="display:none">' + movie.link + '</div><div class="searchshowlink"><a href="#" onclick="showlink(event, this)">' + langstrings[lang]['showlink'] + '</a></div>';
				searchresults.appendChild(entry);
			} 
			if (results.didyoumeanresults.length > 0) { document.getElementById('didyoumean').innerHTML = '<p>' + langstrings[lang]['didyoumean'] + '</p>'; }
			for (var i = 0; i < results.didyoumeanresults.length; i++) { 
				var search = results.didyoumeanresults[i];
				document.getElementById('didyoumean').innerHTML = document.getElementById('didyoumean').innerHTML + '<a href="javascript:search(\'' + search + '\')">' + search + '</a>, ';
			} 
		}
		function search(searchterm) {
			currentsearchterm = searchterm;
			document.getElementById('didyoumean').innerHTML = "";
			document.getElementById('searchresults').innerHTML = "";
			processUserEntry();
		}
		
		function showlink(e, o) {
			o.parentNode.previousSibling.style.display = "";
			o.parentNode.style.display = "none";
		}
		
		/** toggles the drop down menu when the user clicks on the button */
		function keepDropdownMenu(e, o) {
			var menu = o.parentNode.getElementsByTagName('ul')[0];
			if (menu.style.display == 'block') {
				menu.style.display = "none";
			} else {
				menu.style.display = "block";
			}
		}
				
				
				

		
		/** login and registration management */
		
				
		function logincallback(result) {
			if (result == 1) {
				includeScript('http://uploads.cacaoweb.org/isloggedin.php', 'isloggedinscript');
			} else {
				alert("username or password is wrong");
			}
		}
		function isloggedincallback(result, user, money) {
			if (result == 1) {
				username = user;
				money = money;
				document.getElementById('loginbutton').style.display = "none";
				document.getElementById('auth-notification').innerHTML = langstrings[lang]['welcome']  + user;
			} 
		}
		
		
		function stopEvent(e) {
			if (e.stopPropagation) e.stopPropagation();
			else e.cancelBubble = true;

			if (e.preventDefault) e.preventDefault();
			else e.returnValue = false;
		}
		function submitlogin(e) {
			stopEvent(e);
			var username = document.getElementById('logininput').value;
			var password = document.getElementById('passwordinput').value;
			includeScript('http://uploads.cacaoweb.org/login.php?username=' + encodeURIComponent(username) + "&password=" + encodeURIComponent(password), 'loginscript');
			return false;
		}
		
		function register() {
			window.open('admin.html?register', '_newtab')
		}
		
		
		
		/** initialisation, check the url to know whether some video has to be played */
		function init() {
			var url = window.location.href;
			if (url.indexOf("play=") > -1) {
				var pos = url.indexOf("videoid=");
				var pos1 = url.indexOf("&", pos);
				if (pos1 > -1) {
					var videoid = url.substr(pos + 8, pos1 - pos - 8);
				} else {
					var videoid = url.substr(pos + 8);
				}
				if (url.indexOf("provider=mv") > -1) {
					play("http://127.0.0.1:4001/megavideo/megavideo.caml?videoid=" + videoid);
				} else if (url.indexOf("provider=bb") > -1) {
					play("http://127.0.0.1:4001/videobb/videobb.caml?videoid=" + videoid);
				} else if (url.indexOf("provider=cacao") > -1) {
					play("http://127.0.0.1:4001/" + videoid);
				}
			}
		}
		
		
		
		
		init();
		/** callback is isloggedincallback(isloggedin, username, money) */
		includeScript('http://uploads.cacaoweb.org/isloggedin.php', 'isloggedinscript');

		
	</script>
	
	
</body>
</html>