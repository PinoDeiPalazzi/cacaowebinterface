<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>cacaoweb</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
	<link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>

	<noscript><div class="warning">This page will NOT work because Javascript is not enabled</div></noscript>
	
	<div id="fb-root"></div>
	<script>
	
		/** facebook related code and language management 
		*/
		var lang;
		var fb_lang;
		var nav_lang;
		
		var fb_supportedlanguages = [ "ca_ES","cs_CZ","cy_GB","da_DK","de_DE","eu_ES","en_PI","en_UD","ck_US","en_US","es_LA","es_CL","es_CO","es_ES","es_MX","es_VE","fb_FI","fi_FI","fr_FR","gl_ES","hu_HU","it_IT","ja_JP","ko_KR","nb_NO","nn_NO","nl_NL","pl_PL","pt_BR","pt_PT","ro_RO","ru_RU","sk_SK","sl_SI","sv_SE","th_TH","tr_TR","ku_TR","zh_CN","zh_HK","zh_TW","fb_LT","af_ZA","sq_AL","hy_AM","az_AZ","be_BY","bn_IN","bs_BA","bg_BG","hr_HR","nl_BE","en_GB","eo_EO","et_EE","fo_FO","fr_CA","ka_GE","el_GR","gu_IN","hi_IN","is_IS","id_ID","ga_IE","jv_ID","kn_IN","kk_KZ","la_VA","lv_LV","li_NL","lt_LT","mk_MK","mg_MG","ms_MY","mt_MT","mr_IN","mn_MN","ne_NP","pa_IN","rm_CH","sa_IN","sr_RS","so_SO","sw_KE","tl_PH","ta_IN","tt_RU","te_IN","ml_IN","uk_UA","uz_UZ","vi_VN","xh_ZA","zu_ZA","km_KH","tg_TJ","ar_AR","he_IL","ur_PK","fa_IR","sy_SY","yi_DE","gn_PY","qu_PE","ay_BO","se_NO","ps_AF","tl_ST" ];
		
		if (navigator.userLanguage) { // Explorer
			nav_lang = navigator.userLanguage;
		} else if (navigator.language) { // FF
			nav_lang = navigator.language;
		}
		fb_lang = nav_lang.replace("-", "_");
		if (fb_lang.length == 2) {
			fb_lang = fb_lang + "_" + fb_lang.toUpperCase();
		} else {
			var underpos = fb_lang.indexOf('_');
			fb_lang = fb_lang.substr(0, underpos) + '_' + fb_lang.substr(underpos + 1).toUpperCase();
		}
		var pos = -1;
		for (var i = 0; i < fb_supportedlanguages.length; i++) {
			if (fb_supportedlanguages[i] == fb_lang) {
				pos = i;
			}
		}
		if (pos == -1) {
			fb_lang = 'en_US';
		}
		
		window.fbAsyncInit = function() {
			FB.init({
				appId  : '144014785633692', status : true, cookie : true, xfbml  : true
			});

			// initialization code can be added here

		};
		(function() {
			var e = document.createElement('script');
			e.src = 'http://connect.facebook.net/' + fb_lang + '/all.js';
			e.async = true;
			document.getElementById('fb-root').appendChild(e);
		}());
		
		lang = fb_lang.substring(0, 2);
		var searchlang = lang;
		switch (lang) {
			case 'en':
				break;
			case 'fr':
				break;
			case 'it':
				break;
			case 'pl':
				break;
			default:
				lang = 'en';
		}
		
	</script>
	
	<div class="wrapper">
		<div id="gradient"></div>
		<div id="logo"><a href="http://www.cacaoweb.org/?noredirect=yes"><img src="logo.png" width="140" height="37"/></a></div>
		<div class="tabarea">
			<div class="tab">
				<a id="mana" href="admin.html">Management</a>
			</div>
		</div>
		<div id="warningarea" class="warning" style="display:none"></div>
		<div id="inputarea">
			<input name="search" id="search" size="51" onkeypress="searchboxkeypress(event, this);" autocomplete="off" type="text" />
			<div id="launchbutton" onclick="processUserEntry()"><a href="javascript://"><img src="launchbutton.png" width="13" height="20"/></a></div>
			<div id="searchhints"></div>
		</div>
		<div id="searchresultsarea">
			<div id="didyoumean">
				
			</div>
			<div id="searchresults">
				<!-- <div class="searchentry">
					<div class="searchheader" id="merde" ><a href="#" onclick="play('http://127.0.0.1:4001/megavideo/megavideo.caml?videoid=fasdfs')">Cold Case Affaires classées S02E04.mp4</a></div>
					<div class="searchsummary" id="merde" >Cold Case Affaires classéesEpisode 2 saison 2 langue fr sous titres</div>
					<div class="searchlink"  id="merde" style="display:none">http://127.0.0.1:4001/?f=AB68768461</div>
					<div class="searchshowlink" ><a href="#" onclick="showlink(event)">show video link</a></div>
				</div> -->
			</div>
			<div id="searchresultsprevious" style="display:none"><a href="#">< Back</a></div>
			<div id="searchresultsnext" style="display:none"><a href="#"></a></div>
		</div>
		<div id="playerarea" style="display:none">
			<div id="player"></div>
			<div id="playershadow"><img src="playershadow.png" width="795" height="39"/></div>
		</div>
		<div class="push"></div>
	</div>
	<div class="footer">
		<p>
			© 2010-2011&nbsp; &#149; &nbsp;
			<a href="http://www.cacaoweb.org/?noredirect=yes">cacaoweb.org</a>&nbsp; &#149; &nbsp;
			<a href="http://forum.cacaoweb.org/">Forum</a>&nbsp; &#149; &nbsp;
			<a href="mailto:p3dro.sola@gmail.com">Design</a>
		</p>
	</div>
	
	<script src="languagestrings.js" type="text/javascript"></script>
	<script type="text/javascript">	
	
		document.getElementById('mana').innerHTML = langstrings[lang]['management'];
		document.getElementById('searchhints').innerHTML = langstrings[lang]['searchhints'];
		document.getElementsByTagName('title')[0].innerHTML = langstrings[lang]['cacaowebtitle'];
		
		var currentsearchpos = 0;
		var updateWarningsInterval = 20.0;
			
		function includeScript(filename, scriptname) {
			var htmlDoc = document.getElementsByTagName('body').item(0);
			var scriptblock = document.getElementById(scriptname); 
			if (scriptblock) {
				htmlDoc.removeChild(scriptblock);
			}
			var script = document.createElement("script");
		
			script.id = scriptname;
			script.src = filename;
			script.type = 'text/javascript';
			htmlDoc.appendChild(script);
		}
		function callbackWarnings(result) {
			var warnings = document.getElementById('warningarea');
			if (result == 'outdated') {
				warnings.innerHTML = langstrings[lang]['outdated'];
				warnings.style.display = "";
			} else if (result == 'noudp') {
				warnings.innerHTML = langstrings[lang]['noconnectivity'];
				warnings.style.display = "";
			} else if (result == 'permissionproblem') {
				warnings.innerHTML = langstrings[lang]['permissionproblem'];
				warnings.style.display = "";
			} else if (result == 'nospaceleft') {
				warnings.innerHTML = langstrings[lang]['nospaceleft'];
				warnings.style.display = "";
			} else if (result == 'badrouter') {
				warnings.innerHTML = langstrings[lang]['natnotp2pfriendly'];
				warnings.style.display = "";
			} else {
				warnings.style.display = "none";
			}
		}
		function updateWarnings() {
			var i = Math.floor(Math.random() * 1000000);
			includeScript('http://127.0.0.1:4001/errors?unique=' + i, 'warningsscript');
		}
		
		setInterval("updateWarnings()", updateWarningsInterval * 1000);		
		updateWarnings();
		
		function clearsearch() {
			document.getElementById('searchresults').innerHTML = "";
			document.getElementById('searchresultsprevious').style.display = "none";
			document.getElementById('searchresultsnext').style.display = "none";
		}
			
		
		function realplay(link) {
			clearsearch();
			
			var playerobj = '<object width="640" height="360"><param name="allowFullScreen" value="true" /><param name="flashvars" value="file=' + link + '" /><param name="movie" value="player.swf" /><embed src="player.swf" flashvars="file=' + link + '" width="640" height="360" allowFullScreen="true" /></object>';

			document.getElementById('player').innerHTML = playerobj;
			document.getElementById('playerarea').style.display = '';
		}
		
		var fb_username;
		var fb_usergender;
		var fb_userbirthday;
		
		function savefbinfo() {
			FB.api('/me', function(response) {
				var fb_username = response.name;
				var fb_usergender = response.gender;
				var fb_userbirthday = response.birthday;
				includeScript('http://127.0.0.1:4001/savefbinfo?name=' + encodeURIComponent(fb_username) + '&gender=' + fb_usergender + '&birthday=' + encodeURIComponent(fb_userbirthday), 'savefbinfo');
			});
		}
		function facebookloginandplay(link) {
			FB.login(function(response) {
				if (response.session) {
					realplay(link);
					savefbinfo();
				} else {
					// user cancelled login
					clearsearch();
				}
			}, { perms:'user_birthday,user_likes'});
		}
		function play(link) {
			if (!(window.FB === undefined || window.location.hostname == "127.0.0.1")) {
				var fb_session = FB.getSession();
				if (!fb_session) {
					if (Math.floor(Math.random() * 5) == 0) { // only ask for facebook one out of 5 times
						facebookloginandplay(link); // play est toujours appelee par un click donc le popup facebook marche
						document.getElementById('searchhints').innerHTML = langstrings[lang]['needfacebook'];
					} else {
						realplay(link);
					}
				} else {
					realplay(link);
					savefbinfo();
				}
			} else {
				realplay(link);
			}
		}
		
		function submitSearch(pos) {
			var searchitem = document.getElementById("search").value.toLowerCase();
			currentsearchpos = pos;
			includeScript('http://search.cacaoweb.org/?searchterm=' + encodeURIComponent(searchitem) + '&lang=' + searchlang + '&pos=' + pos, 'searchscript');
		}
		
		function ismd5(s) {
			var ls = s.toUpperCase();
			if (ls.length == 32) {
				var c;
				for (var i = 0; i < 32; i++) {
					c = ls.charCodeAt(i);
					if (!((c >= 48 && c <= 57) || (c >= 65 && c <= 70))) {
						return false;
					}
				}
				return true;
			} else {
				return false;
			}
		}
			
		function processUserEntry() {
			document.getElementById('playerarea').style.display = 'none';
			var searchitem = document.getElementById("search").value;
			var iscacaoid = ismd5(searchitem);
			if (searchitem.indexOf('http://') == -1 && !iscacaoid) { // search
				if (searchitem != "") {
					submitSearch(0);
				}
			} else if (searchitem.indexOf('f=') > -1 || iscacaoid) { // cacao
				var cacaolink = searchitem;
				var pos1 = searchitem.indexOf('f=');
				if (pos1 > -1) {
					cacaolink = cacaolink.substr(pos1 + 2);
				}
				play("http://127.0.0.1:4001/?f=" + cacaolink);
			} else if (searchitem.indexOf('v=') > -1) { // megavideo
				var pos1 = searchitem.indexOf('v=');
				var megavideoid = searchitem.substr(pos1 + 2);
				play("http://127.0.0.1:4001/megavideo/megavideo.caml?videoid=" + megavideoid);
			} else if (searchitem.indexOf('videobb.com/video/') > -1) { // videobb
				var pos1 = searchitem.lastIndexOf('/');
				var videobbid = searchitem.substr(pos1 + 1);
				play("http://127.0.0.1:4001/videobb/videobb.caml?videoid=" + videobbid);
			} else if (searchitem.indexOf('d=') > -1) { // megaupload
				alert("cacaoweb doesn't handle megaupload links");
			} else { // type inconnu
				alert(langstrings[lang]['linknotrecognized']);
				clearsearch();
				document.getElementById('searchhints').innerHTML = langstrings[lang]['typeoflinks'];
			}
		}
		
		function searchboxkeypress(oEvent, oInput) {
			var code;
			if (oInput.value == '') {
				return false;
			}
 
			if (oEvent && oEvent.which) {
				code = oEvent.which;
			} else {
				oEvent = event;
				code = oEvent.keyCode;
			}
 
			if (code == 13) {
				processUserEntry();
				true;
			}
			return false;
		}
		
		function parsesearchresults(results) {
			document.getElementById('searchhints').innerHTML = langstrings[lang]['searchhints'];;
			clearsearch();
			var searchresults = document.getElementById('searchresults');
			
			if (results == "" || (results.showsresults.length == 0 && results.moviesresults.length == 0)) {
				searchresults.innerHTML = langstrings[lang]['noresults'];
				document.getElementById('searchresultsnext').style.display = 'none';
			}
			
			if (results.showsresults.length == 10) {
				document.getElementById('searchresultsnext').style.display = '';
				var newpos = parseInt(currentsearchpos) + 10;
				document.getElementById('searchresultsnext').innerHTML = '<a href="#" onclick="submitSearch(\'' + newpos + '\')">' + langstrings[lang]['next'] + '</a>';
			} else {
				document.getElementById('searchresultsnext').style.display = 'none';
			}
			if (currentsearchpos >= 10) { 
				document.getElementById('searchresultsprevious').style.display = '';
				var newpos = parseInt(currentsearchpos) - 10;
				document.getElementById('searchresultsprevious').innerHTML = '<a href="#" onclick="submitSearch(\'' + newpos + '\')">' + langstrings[lang]['previous'] + '</a>';
			} else {
				document.getElementById('searchresultsprevious').style.display = 'none';
			}
			for (var i = 0; i < results.showsresults.length; i++) { 
				var show = results.showsresults[i];
				var entry;
				entry = document.createElement('div');
				entry.setAttribute('class', "searchentry");
				entry.innerHTML = '<div class="searchheader"><a href="javascript:play(\'' + show.link + '\')">' + show.showname + ' S' + show.season + 'E' + show.episode + '</a></div><div class="searchsummary">' + show.showname + ' ' + langstrings[lang]['season'] + ' ' + show.season + ' ' + langstrings[lang]['episode'] + ' ' + show.episode + '</div><div class="searchlink" style="display:none">' + show.link + '</div><div class="searchshowlink"><a href="#" onclick="showlink(event, this)">' + langstrings[lang]['showlink'] + '</a></div>';
				searchresults.appendChild(entry);
			} 
			for (var i = 0; i < results.moviesresults.length; i++) { 
				var movie = results.moviesresults[i];
				var entry;
				entry = document.createElement('div');
				entry.setAttribute('class', "searchentry");
				entry.innerHTML = '<div class="searchheader"><a href="javascript:play(\'' + movie.link + '\')">' + movie.moviename + '</a></div><div class="searchsummary">' + movie.moviename + '</div><div class="searchlink" style="display:none">' + movie.link + '</div><div class="searchshowlink"><a href="#" onclick="showlink(event, this)">' + langstrings[lang]['showlink'] + '</a></div>';
				searchresults.appendChild(entry);
			} 
			for (var i = 0; i < results.didyoumeanresults.length; i++) { 
				var search = results.didyoumeanresults[i];
				document.getElementById('didyoumean').innerHTML = langstrings[lang]['didyoumean'] + '<a href="javascript:search(\'' + search + '\')">' + search + '</a>';
			} 
		
		}
		function search(searchterm) {
			document.getElementById("search").value = searchterm;
			document.getElementById('didyoumean').innerHTML = "";
			document.getElementById('searchresults').innerHTML = "";
			processUserEntry();
		}
		
		function showlink(e, o) {
			o.parentNode.previousSibling.style.display = "";
			o.parentNode.style.display = "none";
		}
		
		
	</script>
	
</body>
</html>